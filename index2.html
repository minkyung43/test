<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Commuter Calendar + AI Personalization</title>
  <style>
    body {
      margin:0;
      background: linear-gradient(180deg,#F6F7FB, #FFFFFF);
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
    }

    .app {
      max-width:960px;
      margin:32px auto;
      padding:24px;
    }

    .header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:16px;
    }

    .title { display:flex; flex-direction:column; }
    .title h1 { margin:0; font-size:20px; }
    .title p { margin:0; font-size:13px; color:#8891a0; }

    .controls {
      display:flex;
      gap:8px;
      align-items:center;
    }

    .btn {
      border:1px solid #e2e4ea;
      background:white;
      padding:8px 12px;
      border-radius:8px;
      cursor:pointer;
    }

    .primary {
      background:#4a6cf7;
      color:white;
      border:none;
    }

    .calendar-card {
      background:white;
      padding:24px;
      border-radius:12px;
      box-shadow:0 2px 6px rgba(0,0,0,0.05);
    }

    .weekdays, .grid-days {
      display:grid;
      grid-template-columns: repeat(7,1fr);
      gap:8px;
      text-align:center;
    }

    .day {
      padding:12px;
      border-radius:6px;
      cursor:pointer;
    }

    .modal-backdrop {
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.3);
      display:flex;
      justify-content:center;
      align-items:center;
    }

    .modal {
      background:white;
      border-radius:12px;
      padding:24px;
      width:360px;
      max-width:90%;
      box-shadow:0 6px 20px rgba(0,0,0,0.1);
    }

    .field { margin-bottom:12px; display:flex; flex-direction:column; }

    .ai-section {
      margin-top:20px;
      padding:16px;
      border-radius:12px;
      background:#f7f8fc;
      border:1px solid #e5e7ef;
    }

    .ai-section h4 { margin-top:0; margin-bottom:6px; }
    .select-row { display:flex; flex-direction:column; margin-bottom:10px; }
  </style>
</head>

<body>
<div class="app">
  <div class="header">
    <div class="title">
      <h1>Commuter Calendar</h1>
      <p>출근길 루트 + 버스 콘텐츠 AI 추천 데모</p>
    </div>

    <div class="controls">
      <button class="btn" id="todayBtn">오늘</button>
      <button class="btn" id="prevBtn">&larr;</button>
      <div id="monthLabel" style="min-width:140px;text-align:center;font-weight:600;">—</div>
      <button class="btn" id="nextBtn">&rarr;</button>
    </div>
  </div>

  <div class="calendar-card">
    <div class="weekdays" id="weekdays"></div>
    <div class="grid-days" id="gridDays"></div>
  </div>
</div>

<!-- Modal -->
<div id="modalBackdrop" class="modal-backdrop" style="display:none;">
  <div class="modal">
    <h3 id="modalTitle">날짜</h3>
    <div id="modalDateInfo" style="color:#8891a0; margin-bottom:10px;"></div>

    <!-- AI Personalization Section -->
    <div class="ai-section">
      <h4>AI 출근길 추천</h4>

      <div class="select-row">
        <label>이동 스타일</label>
        <select id="commuteStyle">
          <option value="comfort">조금 느려도 편하게</option>
          <option value="fast">제일 빠르게</option>
        </select>
      </div>

      <div class="select-row">
        <label>버스 안에서 하는 행동</label>
        <select id="busStyle">
          <option value="phone">스마트폰 보는 유형</option>
          <option value="music">음악 듣는 유형</option>
          <option value="book">책 읽는 유형</option>
        </select>
      </div>

      <button class="btn primary" id="genAI">추천 생성</button>

      <div id="aiOutput" style="margin-top:12px; font-size:14px; white-space:pre-line;"></div>
    </div>

    <div style="text-align:right; margin-top:20px;">
      <button class="btn" id="closeModal">닫기</button>
    </div>
  </div>
</div>

<script>
/* -------------------------
   Calendar Logic
-------------------------- */

const weekdaysKorean = ['일','월','화','수','목','금','토'];
const LS_KEY = "commuter-calendar-simple";

const state = {
  viewDate: new Date(),
};

function renderCalendar(){
  const monthLabel = document.getElementById("monthLabel");
  monthLabel.textContent = `${state.viewDate.getFullYear()}년 ${state.viewDate.getMonth()+1}월`;

  const weekdays = document.getElementById("weekdays");
  weekdays.innerHTML = weekdaysKorean.map(d => `<div>${d}</div>`).join("");

  const grid = document.getElementById("gridDays");
  grid.innerHTML = "";

  const first = new Date(state.viewDate.getFullYear(), state.viewDate.getMonth(), 1);
  const last = new Date(state.viewDate.getFullYear(), state.viewDate.getMonth()+1, 0);

  for(let i=0; i<first.getDay(); i++){
    grid.insertAdjacentHTML("beforeend", `<div></div>`);
  }

  for(let d=1; d<=last.getDate(); d++){
    const date = new Date(state.viewDate.getFullYear(), state.viewDate.getMonth(), d);
    const key = date.toISOString().slice(0,10);

    grid.insertAdjacentHTML("beforeend", `
      <div class="day" data-date="${key}">
        ${d}
      </div>
    `);
  }

  document.querySelectorAll(".day").forEach(el=>{
    el.addEventListener("click", onClickDay);
  });
}

function onClickDay(e){
  const key = e.target.dataset.date;
  openModal(key);
}

/* -------------------------
   Modal & AI Feature
-------------------------- */

const modal = document.getElementById("modalBackdrop");
const dateInfo = document.getElementById("modalDateInfo");

let selectedDate = "";

function openModal(key){
  selectedDate = key;
  modal.style.display = "flex";

  document.getElementById("modalTitle").textContent = "선택한 날짜";
  dateInfo.textContent = key;
}

document.getElementById("closeModal").addEventListener("click", ()=>{
  modal.style.display = "none";
});

/* -------------------------
   AI Personalization Demo
-------------------------- */

document.getElementById("genAI").addEventListener("click", ()=>{
  const commuteStyle = document.getElementById("commuteStyle").value;
  const busStyle = document.getElementById("busStyle").value;

  let route = "";
  let content = "";

  if(commuteStyle === "comfort") {
    route = "· 덜 붐비는 버스 루트 추천 (환승 최소)\n· 좌석 착석 확률 높은 정류장 선택";
  } else {
    route = "· 가장 빠른 환승 루트\n· 실시간 버스 도착 기반 최단 이동 추천";
  }

  if(busStyle === "phone") {
    content = "· 오늘 날씨 기반 출근 체크리스트\n· 5~8분 분량의 짧은 AI 큐레이션 뉴스 추천";
  } else if(busStyle === "music") {
    content = "· 아침 집중용 플레이리스트 추천\n· 감정 기반 음악 자동 구성";
  } else {
    content = "· 10분 분량 AI 요약 독서 콘텐츠\n· 현재 관심사 기반 책 미리보기 제공";
  }

  document.getElementById("aiOutput").textContent =
    `[출근 루트 추천]\n${route}\n\n[버스 안 콘텐츠 추천]\n${content}`;
});

/* -------------------------
   Navigation
-------------------------- */

document.getElementById("todayBtn").addEventListener("click", ()=>{
  state.viewDate = new Date();
  renderCalendar();
});

document.getElementById("prevBtn").addEventListener("click", ()=>{
  state.viewDate = new Date(state.viewDate.getFullYear(), state.viewDate.getMonth()-1, 1);
  renderCalendar();
});

document.getElementById("nextBtn").addEventListener("click", ()=>{
  state.viewDate = new Date(state.viewDate.getFullYear(), state.viewDate.getMonth()+1, 1);
  renderCalendar();
});

renderCalendar();
</script>

</body>
</html>
